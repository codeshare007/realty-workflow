<div [@routerTransition]>
    <div class="content d-flex flex-column flex-column-fluid">
        <sub-header [title]="'Manage Customer'">
        </sub-header>
        <div [class]="containerClass">
            <div class="card card-custom gutter-b">
                <div class="card-body">
                    <tabset>
                        <tab heading="{{'Transactions' | localize}}">

                        </tab>
                        <tab heading="{{'Leads' | localize}}">
                            <div [hidden]="selectedListing">
                                <div class="row mt-3">
                                    <div class="col-6">
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="streetNameFilter"> Street Name
                                                            <input type="text" class="form-control" name="streetNameFilter"
                                                                [(ngModel)]="input.streetName" />
                                                        </label> </div>
                                                </div>
                                                <div class="col-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="streetNumberFilter">Street Number
                                                            <input type="text" class="form-control" name="streetNumberFilter"
                                                                id="streetNumberFilter" [(ngModel)]="input.streetNumber" />
                                                        </label> </div>
                                                </div>
                                                <div class="col-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="zip"> Zip
                                                            <input type="text" class="form-control" name="zip"
                                                                [(ngModel)]="input.zip" />
                                                        </label> </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-xl-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="minimalrent">Minimal Rent
                                                            <input type="number" class="form-control" name="minimalrent"
                                                                id="minimalrent" [(ngModel)]="input.minimalRent" />
                                                        </label> </div>
                                                </div>
                                                <div class="col-xl-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="MaximalRent"> Maximal Rent
                                                            <input type="number" class="form-control" name="MaximalRent"
                                                                [(ngModel)]="input.maximalRent" />

                                                        </label> </div>
                                                </div>
                                                <div class="col-xl-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="Bathrooms">Bathrooms
                                                            <input type="number" class="form-control" name="Bathrooms" id="Bathrooms"
                                                                [(ngModel)]="input.bathrooms" />
                                                        </label> </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col-xl-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="Bedrooms"> Bedrooms
                                                            <input type="number" class="form-control" name="Bedrooms"
                                                                [(ngModel)]="input.minimumBedrooms" />

                                                        </label> </div>
                                                </div>
                                                <div class="col-xl-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="AvailableFrom"> Available From
                                                            <input type="text" bsDatepicker class="form-control" name="AvailableFrom"
                                                                id="AvailableFrom" [(ngModel)]="input.availableFrom" />
                                                        </label> </div>
                                                </div>
                                                <div class="col-xl-4 mb-4" [hidden]="!advancedFiltersAreShown">
                                                    <div class="form-goup">
                                                        <label for="AvailableTo"> Available To
                                                            <input type="text" bsDatepicker class="form-control" name="AvailableTo"
                                                                id="AvailableTo" [(ngModel)]="input.availableTo" />
                                                        </label> </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="row" [hidden]="!advancedFiltersAreShown">
                                            <div class="form-goup">
                                                <label style="margin-bottom: 0;">{{"Pets" | localize}}:</label>
                                                <div class="checkbox-inline" *ngFor="let petsFilter of petsFilters">
                                                    <label [for]="'petsFilter' + petsFilter.value" class="checkbox">
                                                        <input [id]="'petsFilter' + petsFilter.value" type="checkbox"
                                                            [name]="'petsFilter' + petsFilter.value" [(ngModel)]="petsFilter.checked">
                                                        <span></span>
                                                        {{ petsFilter.label }}
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" [hidden]="!advancedFiltersAreShown">
                                            <div class="form-goup">
                                                <label style="margin-bottom: 0;">{{"Media" | localize}}:</label>
                                                <div class="checkbox-inline" *ngFor="let mediaFilter of mediaFilters">
                                                    <label [for]="'mediaFilter' + mediaFilter.value" class="checkbox">
                                                        <input [id]="'mediaFilter' + mediaFilter.value" type="checkbox"
                                                            [name]="'mediaFilter' + mediaFilter.value"
                                                            [(ngModel)]="mediaFilter.checked">
                                                        <span></span>
                                                        {{ mediaFilter.label }}
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" [hidden]="!advancedFiltersAreShown">
                                            <div class="form-goup">
                                                <label style="margin-bottom: 0;">{{"Status" | localize}}:</label>
                                                <div class="checkbox-inline" *ngFor="let statusFilter of statusFilters">
                                                    <label [for]="'statusFilter' + statusFilter.value" class="checkbox">
                                                        <input [id]="'statusFilter' + statusFilter.value" type="checkbox"
                                                            [name]="'statusFilter' + statusFilter.value"
                                                            [(ngModel)]="statusFilter.checked">
                                                        <span></span>
                                                        {{ statusFilter.label }}
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-4" [hidden]="!advancedFiltersAreShown">
                                        <div class="row">
                                            <mat-form-field class="example-chip-list">
                                                <mat-chip-list #chipList aria-label="Fruit selection">
                                                    <mat-chip *ngFor="let city of selectedCities" [selectable]="true" [removable]="true"
                                                        (removed)="removeCity(city)">
                                                        {{city}}
                                                        <mat-icon matChipRemove>cancel</mat-icon>
                                                    </mat-chip>
                                                    <input placeholder="Cities..." #citiesFilterInput [formControl]="cityCtrl"
                                                        [matAutocomplete]="auto" [matChipInputFor]="chipList"
                                                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                        (matChipInputTokenEnd)="add($event)">
                                                </mat-chip-list>
                                                <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectCity($event)">
                                                    <mat-option *ngFor="let city of filteredCities | async" [value]="city">
                                                        {{city}}
                                                    </mat-option>
                                                </mat-autocomplete>
                                            </mat-form-field>

                                        </div>
                                    </div>
                                    <!-- 
                                <div class="checkbox-inline">
                                    <label for="EditUser_SetRandomPassword" class="checkbox">
                                        <input id="EditUser_SetRandomPassword" type="checkbox" name="SetRandomPassword"
                                            [(ngModel)]="setRandomPassword">
                                        <span></span>
                                        {{"SetRandomPassword" | localize}}
                                    </label>
                                </div> -->



                                </div>
                                <div>
                                    <!-- <ngx-tags-input name="tags" [(ngModel)]="citiefFilters" [displayField]="'label'"
                                    (onTagsChanged)="getListings()">
                                </ngx-tags-input> -->
                                </div>
                                <div class="row">
                                    <div class="col-xl-2 mb-4" style="padding-top: 8px;">

                                        <span class="clickable-item text-muted" *ngIf="!advancedFiltersAreShown"
                                            (click)="advancedFiltersAreShown=!advancedFiltersAreShown"><i class="fa fa-angle-down"></i>
                                            {{"ShowAdvancedFilters" | localize}}</span>
                                        <span class="clickable-item text-muted" *ngIf="advancedFiltersAreShown"
                                            (click)="advancedFiltersAreShown=!advancedFiltersAreShown"><i class="fa fa-angle-up"></i>
                                            {{"HideAdvancedFilters" | localize}}</span>
                                    </div>
                                    <div class="col-xl-1 mb-4" *ngIf="advancedFiltersAreShown">
                                        <button class="btn btn-primary" (click)="getListings(undefined)"><i class="fa fa-sync"></i>
                                            {{"Refresh" | localize}}</button>
                                    </div>
                                </div>
                                <div class="primeng-datatable-container">
                                    <p-table #dataTable sortMode="multiple" (onLazyLoad)="getListings($event)"
                                        [value]="primengTableHelper.records" [lazy]="true" [scrollable]="true" ScrollWidth="100%"
                                        [responsive]="primengTableHelper.isResponsive"
                                        [resizableColumns]="primengTableHelper.resizableColumns">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th pSortableColumn="city">
                                                    {{'City' | localize}}
                                                    <p-sortIcon field="city"></p-sortIcon>
                                                </th>
                                                <th pSortableColumn="address">
                                                    {{'Adress' | localize}}<p-sortIcon field="address"></p-sortIcon>
                                                </th>
                                                <th>
                                                    {{'Unit' | localize}}
                                                </th>
                                                <th pSortableColumn="rent">
                                                    {{'Rent' | localize}} <p-sortIcon field="rent"></p-sortIcon>
                                                </th>
                                                <th pSortableColumn="beds">
                                                    {{'Bed' | localize}} <p-sortIcon field="beds"></p-sortIcon>
                                                </th>
                                                <th pSortableColumn="baths">
                                                    {{'Bath' | localize}} <p-sortIcon field="baths"></p-sortIcon>
                                                </th>
                                                <th>
                                                    {{'Fee' | localize}}
                                                </th>

                                                <th pSortableColumn="availDate">
                                                    {{'AvailableDate' | localize}} <p-sortIcon field="availDate"></p-sortIcon>
                                                </th>

                                                <th pSortableColumn="updateDate">
                                                    {{'Updated' | localize}} <p-sortIcon field="updateDate"></p-sortIcon>
                                                </th>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="body" let-record="$implicit">
                                            <tr (click)="selectedListing = record">
                                                <td>
                                                    <span class="ui-column-title"> {{'City' | localize}}</span>
                                                    <span>
                                                        {{record.city}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Adress' | localize}}</span>
                                                    <span>
                                                        {{record.streetName}} {{record.streetNumber}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Unit' | localize}}</span>
                                                    <span>
                                                        {{record.unit}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Rent' | localize}}</span>
                                                    <span>
                                                        {{record.price}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Bed' | localize}}</span>
                                                    <span>
                                                        {{record.bedInfo}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Bath' | localize}}</span>
                                                    <span>
                                                        {{record.baths}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Fee' | localize}}</span>
                                                    <span>
                                                        {{record.fee}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'AvailableDate' | localize}}</span>
                                                    <span>
                                                        {{record.availableDate}}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="ui-column-title"> {{'Updated' | localize}}</span>
                                                    <span>
                                                        {{fromNow(record.updateDate)}}
                                                    </span>
                                                </td>

                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <div class="primeng-paging-container">
                                        <p-paginator [rows]="primengTableHelper.defaultRecordsCountPerPage" #paginator
                                            (onPageChange)="getListings($event)" [totalRecords]="primengTableHelper.totalRecordsCount"
                                            [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">

                                        </p-paginator>
                                        <span class="total-records-count">
                                            {{'TotalRecordsCount' | localize:primengTableHelper.totalRecordsCount}}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <listing-page *ngIf="!!selectedListing" [selectedListing]="selectedListing"> </listing-page>
                            </div>
                        </tab>
                        <tab heading="{{'Communications' | localize}}">
                            <comms-inbox-view class="flex-row-fluid d-block"
                                    [contact]="user.emailAddress"></comms-inbox-view>
                        </tab>
                        <tab heading="{{'UserInformations' | localize}}">
                            <div class="pt-5">
                                <form *ngIf="active" #userForm="ngForm" novalidate (ngSubmit)="save()">
                                    <div class="row">
                                        <div class="col-sm-3 text-center mb-5 mt-5">
                                            <img src="{{profilePicture}}" width="128" height="128" class="img-thumbnail img-rounded" />
                                        </div>
                                        <div class="col-sm-9">
                                            <div class="form-group">
                                                <label for="Name">{{"FirstName" | localize}} *</label>
                                                <input id="Name" #nameInput="ngModel" class="form-control" type="text" name="Name"
                                                    [(ngModel)]="user.name" required maxlength="64">
                                                <validation-messages [formCtrl]="nameInput"></validation-messages>
                                            </div>

                                            <div class="form-group">
                                                <label for="Surname">{{"Surname" | localize}} *</label>
                                                <input id="Surname" #surnameInput="ngModel" type="text" name="Surname" class="form-control"
                                                    [(ngModel)]="user.surname" required maxlength="64">
                                                <validation-messages [formCtrl]="surnameInput"></validation-messages>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="EmailAddress">{{"EmailAddress" | localize}} *</label>
                                        <input id="EmailAddress" #emailAddressInput="ngModel" type="email" name="EmailAddress"
                                            class="form-control" [(ngModel)]="user.emailAddress" required maxlength="256" email />
                                        <validation-messages [formCtrl]="emailAddressInput"></validation-messages>
                                    </div>

                                    <div class="form-group">
                                        <label for="PhoneNumber">{{"PhoneNumber" | localize}}</label>
                                        <input id="PhoneNumber" type="text" name="PhoneNumber" class="form-control"
                                            [(ngModel)]="user.phoneNumber" maxlength="32">
                                    </div>

                                    <div class="form-group">
                                        <label for="UserName">{{"UserName" | localize}} *</label>
                                        <input id="UserName" #userNameInput="ngModel" type="text" [disabled]="!canChangeUserName"
                                            name="UserName" class="form-control" [(ngModel)]="user.userName" required maxlength="256">
                                        <span class="help-block"
                                            *ngIf="!canChangeUserName">{{"CanNotChangeAdminUserName" | localize}}</span>
                                        <validation-messages [formCtrl]="userNameInput"></validation-messages>
                                    </div>

                                    <div class="checkbox-inline">
                                        <label for="EditUser_SetRandomPassword" class="checkbox">
                                            <input id="EditUser_SetRandomPassword" type="checkbox" name="SetRandomPassword"
                                                [(ngModel)]="setRandomPassword">
                                            <span></span>
                                            {{"SetRandomPassword" | localize}}
                                        </label>
                                    </div>
                                    <div class="form-group" *ngIf="!setRandomPassword">
                                        <div class="right">
                                            <label for="Password">{{"Password" | localize}}</label>
                                            <input id="Password" type="password" name="Password" #Password="ngModel" id="Password"
                                                class="form-control" [(ngModel)]="user.password" [required]="!user.id && !setRandomPassword"
                                                maxlength="32" [requireDigit]="passwordComplexitySetting.requireDigit"
                                                [requireLowercase]="passwordComplexitySetting.requireLowercase"
                                                [requireUppercase]="passwordComplexitySetting.requireUppercase"
                                                [requireNonAlphanumeric]="passwordComplexitySetting.requireNonAlphanumeric"
                                                [requiredLength]="passwordComplexitySetting.requiredLength" validateEqual="PasswordRepeat"
                                                reverse="true" autocomplete="new-password">
                                        </div>
                                    </div>
                                    <div [hidden]="setRandomPassword || userForm.form.valid || userForm.form.pristine">
                                        <ul class="help-block text-danger"
                                            *ngIf="userForm.controls['Password'] && userForm.controls['Password'].errors">
                                            <li [hidden]="!userForm.controls['Password'].errors.requireDigit">
                                                {{"PasswordComplexity_RequireDigit_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['Password'].errors.requireLowercase">
                                                {{"PasswordComplexity_RequireLowercase_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['Password'].errors.requireUppercase">
                                                {{"PasswordComplexity_RequireUppercase_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['Password'].errors.requireNonAlphanumeric">
                                                {{"PasswordComplexity_RequireNonAlphanumeric_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['Password'].errors.requiredLength">
                                                {{"PasswordComplexity_RequiredLength_Hint" | localize:passwordComplexitySetting.requiredLength}}
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="form-group" *ngIf="!setRandomPassword">
                                        <div class="right">
                                            <label for="PasswordRepeat">{{"PasswordRepeat" | localize}}</label>
                                            <input id="PasswordRepeat" type="password" name="PasswordRepeat" #PasswordRepeat="ngModel"
                                                class="form-control" [(ngModel)]="userPasswordRepeat"
                                                [required]="!user.id && !setRandomPassword" maxlength="32"
                                                [requireDigit]="passwordComplexitySetting.requireDigit"
                                                [requireLowercase]="passwordComplexitySetting.requireLowercase"
                                                [requireUppercase]="passwordComplexitySetting.requireUppercase"
                                                [requireNonAlphanumeric]="passwordComplexitySetting.requireNonAlphanumeric"
                                                [requiredLength]="passwordComplexitySetting.requiredLength" validateEqual="Password"
                                                reverse="false" autocomplete="new-password">
                                        </div>
                                    </div>
                                    <div [hidden]="setRandomPassword || userForm.form.valid || userForm.form.pristine">
                                        <ul class="help-block text-danger"
                                            *ngIf="userForm.controls['PasswordRepeat'] && userForm.controls['PasswordRepeat'].errors">
                                            <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireDigit">
                                                {{"PasswordComplexity_RequireDigit_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireLowercase">
                                                {{"PasswordComplexity_RequireLowercase_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireUppercase">
                                                {{"PasswordComplexity_RequireUppercase_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireNonAlphanumeric">
                                                {{"PasswordComplexity_RequireNonAlphanumeric_Hint" | localize}}</li>
                                            <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requiredLength">
                                                {{"PasswordComplexity_RequiredLength_Hint" | localize:passwordComplexitySetting.requiredLength}}
                                            </li>
                                            <li [hidden]="userForm.controls['PasswordRepeat'].valid">{{"PasswordsDontMatch" | localize}}
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="checkbox-list">
                                        <label for="EditUser_ShouldChangePasswordOnNextLogin" class="checkbox">
                                            <input id="EditUser_ShouldChangePasswordOnNextLogin" type="checkbox"
                                                name="ShouldChangePasswordOnNextLogin" [(ngModel)]="user.shouldChangePasswordOnNextLogin">
                                            <span></span>
                                            {{"ShouldChangePasswordOnNextLogin" | localize}}
                                        </label>

                                        <label for="EditUser_SendActivationEmail" class="checkbox">
                                            <input id="EditUser_SendActivationEmail" type="checkbox" name="SendActivationEmail"
                                                [(ngModel)]="sendActivationEmail">
                                            <span></span>
                                            {{"SendActivationEmail" | localize}}
                                        </label>

                                        <label for="EditUser_IsActive" class="checkbox">
                                            <input id="EditUser_IsActive" type="checkbox" name="IsActive" [(ngModel)]="user.isActive">
                                            <span></span>
                                            {{"Active" | localize}}
                                        </label>



                                        <label for="EditUser_IsLockoutEnabled" class="checkbox">
                                            <input id="EditUser_IsLockoutEnabled" type="checkbox" name="IsLockoutEnabled"
                                                [(ngModel)]="user.isLockoutEnabled">
                                            <span></span>
                                            {{"IsLockoutEnabled" | localize}}
                                        </label>
                                    </div>
                                    <div class="modal-footer">
                                        <button [disabled]="saving" type="button" class="btn btn-light-primary font-weight-bold"
                                            (click)="close()">{{"Cancel" | localize}}</button>
                                        <button type="submit" class="btn btn-primary font-weight-bold" [disabled]="!userForm.form.valid"
                                            [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')"><i class="fa fa-save"></i>
                                            <span>{{"Save" | localize}}</span></button>
                                    </div>
                                </form>
                            </div>
                        </tab>
                    </tabset>
                </div>
            </div>
        </div>
    </div>
</div>
